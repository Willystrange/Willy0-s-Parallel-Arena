<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="icon" type="image/png" href="icon.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Willy0's Parallel Arena</title>
  <style>
    /* ======================= STYLES GÉNÉRAUX ======================= */
    body {
      font-family: Arial, sans-serif;
      background-image: url('passe-fond.jpeg');
      background-size: cover;
      background-position: center -50px;
      background-repeat: no-repeat;
      margin: 0;
      padding: 0;
    }
    .hidden { display: none; }
    h1 {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #fff;
      border-bottom: 1px solid #ddd;
      padding: 10px;
      text-align: center;
      margin: 0;
      color: #333;
      z-index: 10;
      font-size: 1em;
    }
    .player-info {
      position: fixed;
      top: 40px;
      left: 0;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #ddd;
      z-index: 9;
    }
    .player-info .level-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8em;
    }
    .player-info .level-info .level,
    .player-info .level-info .next-level { flex: 1; }
    .player-info .xp { flex: 2; text-align: center; font-size: 0.8em; }
    .xp-progress-container {
      width: 50%;
      background-color: #fff;
      border: 1px solid #000;
      border-radius: 20px;
      height: 15px;
      position: relative;
      overflow: hidden;
    }
    .xp-progress-bar {
      height: 100%;
      width: 0;
      background-color: #ddd;
      border-radius: 20px;
      transition: width 0.3s ease;
    }
    #xp-progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      text-align: center;
      color: #333;
      font-weight: bold;
      font-size: 0.8em;
      z-index: 1;
    }
    /* ======================= CONTENEUR ET PAGES ======================= */
    .container {
      max-width: 800px;
      margin: 50px auto 20px;
      padding: 20px;
      position: relative;
      height: auto;
      overflow: hidden;
    }
    .page {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      padding: 10px;
      box-sizing: border-box;
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      height: 90%;
      overflow-y: auto;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      position: absolute;
      width: 100%;
    }
    .page.active {
      opacity: 1;
      position: relative;
    }
    /* ======================= RECOMPENSES ======================= */
    .reward {
      background-color: rgba(255, 255, 255, 0.2);
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 8px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      flex-direction: column;
      font-size: 0.8em;
      height: 80px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .reward.redeemed { background-color: #e0e0e0; }
    .reward .badge {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #FFA500;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .reward.redeemed .badge { background-color: #4CAF50; }
    .error-message {
      color: red;
      font-size: 0.8em;
      margin-top: 5px;
      text-align: center;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      50% { transform: translateX(10px); }
      75% { transform: translateX(-10px); }
      100% { transform: translateX(0); }
    }
    .shake { animation: shake 0.5s; }
    /* ======================= CONTROLES ======================= */
    .controls {
      text-align: center;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    .controls .control-buttons { margin-bottom: 20px; }
    .controls .button-container {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .controls button,
    .button-container button {
      background-color: #FFA500;
      color: #fff;
      border: none;
      font-size: 1em;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .controls button:hover,
    .button-container button:hover { background-color: #e68900; }
    /* ======================= FOOTER ======================= */
    .footer {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 0;
      background-color: #f0f0f0;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }
    .footer-icon {
      background: none;
      border: none;
      cursor: pointer;
    }
    .footer-icon img {
      width: 50px;
      height: 50px;
    }
    .footer-icon:hover { opacity: 0.8; }
    .pass-icon img {
      border: 2px solid #ff4500;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }
    .pass-icon:hover img { opacity: 1; }
    /* ======================= POPUPS ======================= */
    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 70%;
      transform: translate(-50%, -50%);
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1001;
    }
    .popup button {
      background-color: orangered;
      color: #fff;
      border: none;
      font-size: 1em;
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 5px;
      margin: 5px;
      transition: background-color 0.3s ease;
      position: relative;
      z-index: 1;
    }
    .popup button:hover { background-color: orange; }
    .loading-popup {
      display: none;
      position: fixed;
      bottom: -100%;
      left: 50%;
      transform: translateX(-50%);
      width: 70%;
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1002;
      transition: bottom 2s ease;
    }
    .loading-popup.active {
      bottom: 50%;
      transform: translate(-50%, 50%);
    }
    .loading-spinner {
      border: 5px solid #ddd;
      border-top: 5px solid orangered;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 10px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .test {
      margin-bottom: 60px;
      color: white;
      font-size: 0.8em;
      text-align: center;
    }
    /* ======================= AUTRES MEDIA QUERIES ======================= */
    @media (orientation: landscape) {
      body { padding: 10px; }
      .test { margin-bottom: 10px; }
      .container {
        max-width: 100%;
        padding: 10px;
        margin: 10px auto;
        margin-bottom: 10px;
      }
      .player-info { top: 40px; font-size: 0.7em; }
      .level-info { align-items: center; }
      .xp-progress-container { width: 70%; height: 10px; }
      .page {
        grid-template-columns: repeat(6, 1fr);
        gap: 5px;
        padding: 5px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        height: auto;
        overflow-y: auto;
      }
      .reward { height: 60px; font-size: 0.7em; padding: 5px; }
      .reward .badge { width: 25px; height: 25px; }
      .controls { margin-top: 40px; }
      .controls button { font-size: 0.8em; padding: 8px 16px; margin-top: 20px; }
      .footer { padding: 1px; }
    }
    .rewards-title {
      font-size: 1.2em;
      text-align: center;
      color: #333;
      margin: 10px 0;
      background-color: #f0f0f0;
      padding: 5px;
      border-radius: 5px;
    }
    .free-rewards { width: 100%; margin-right: 1%; }
    .premium-rewards { width: 100%; margin-left: 1%; }
    .free-rewards .reward { background-color: rgba(255, 255, 255, 0.2); }
    .premium-rewards .reward { background-color: rgba(255, 215, 0, 0.3); }
    @media (prefers-color-scheme: dark) {
      body {
        background-image: url('passe-fond.jpeg');
        background-color: #121212;
      }
      h1 { background-color: #1e1e1e; border-bottom: 1px solid #333; color: #f5f5f5; }
      .player-info { background-color: rgba(30,30,30,0.9); border-bottom: 1px solid #333; color: #f5f5f5; }
      .page { background-color: rgba(30,30,30,0.9); box-shadow: 0 2px 4px rgba(255,255,255,0.1); }
      .reward { background-color: rgba(50,50,50,0.8); border: 1px solid #444; color: #f5f5f5; }
      .reward.redeemed { background-color: #333; }
      .reward .badge { background-color: #444; }
      .reward.redeemed .badge { background-color: #000; }
      .controls button { background-color: #444; color: #fff; }
      .controls button:hover { background-color: #555; }
      .footer { background-color: #333333; box-shadow: 0 -2px 4px rgba(0,0,0,0.5); }
      .footer-icon img { filter: brightness(0.8); }
      .pass-icon img { border-color: #2C3E50; }
      .xp-progress-container { background-color: #444; }
      .xp-progress-bar { background-color: #333; }
      #xp-progress-text { color: #fff; }
      .popup { background-color: rgba(50,50,50,0.99); border: 1px solid #444; }
      .popup button { background-color: #444; }
    }
  </style>
  <!-- Chargement de Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-performance-compat.js"></script>
</head>
<body>
  <h1>Parallel Pass</h1>
  <div class="player-info">
    <div class="level-info">
      <div class="level" id="current-level"></div>
      <div class="xp-progress-container">
        <div class="xp-progress-bar">
          <span id="xp-progress-text"></span>
        </div>
      </div>
      <div class="next-level" id="next-level"></div>
    </div>
  </div>
  <div class="container" id="album-container">
    <!-- Les pages seront créées dynamiquement -->
    <div class="controls">
      <div class="control-buttons">
        <button id="prevPage">Page Précédente</button>
        <button id="nextPage">Page Suivante</button>
      </div>
    </div>
  </div>
  <div class="test">Le Parallel Pass 3 durera du 09 novembre au 14 décembre 2024.</div>
  <div class="footer">
    <button class="footer-icon perso-icon" onclick="viewCharacters()" id="perso-icon">
      <img src="Characters.svg" alt="Personnages">
    </button>
    <button class="footer-icon main-menu-icon" onclick="showMainMenu()">
      <img src="Menu.svg" alt="Menu Principal">
    </button>
    <button class="footer-icon pass-icon" onclick="goToPasse()">
      <img src="Pass.svg" alt="Passe de combat">
    </button>
    <button class="footer-icon" onclick="viewShop()">
      <img src="Shop.svg" alt="Boutique">
    </button>
  </div>
  <div class="popup" id="ad-popup">
    <h2 style="display: flex; justify-content: space-between; align-items: center;">
      Parallel Pass 3 Premium
      <img src="Parallel-Pass-3-premium.png" alt="Icône Parallel Pass 3 Premium" style="width: 80px; height: 80px; margin-left: 10px;">
    </h2>
    <p>Obtenez des récompenses bonus dont le personnage "L'inconnu" au niveau 60 pour 1050 points !</p>
    <div>
      <button onclick="hidePopup()">Annuler</button>
      <button onclick="handlePurchase()">Acheter</button>
      <button onclick='window.location.href="pass_promotion.html"; hidePopup();'>Inspecter</button>
    </div>
  </div>
  <div class="loading-popup" id="loading-popup">
    <div class="loading-spinner"></div>
    <p>Achat en cours...</p>
  </div>
  <script src="localStorage.js"></script>
  <script>
    // ===================== CONFIGURATION FIREBASE =====================
    const firebaseConfig = {
      apiKey: "AIzaSyAwIIKfoYwdtFD63yKhVggZOAnooQion-M",
      authDomain: "willy0s-parallel-arena.firebaseapp.com",
      databaseURL: "https://willy0s-parallel-arena-default-rtdb.firebaseio.com",
      projectId: "willy0s-parallel-arena",
      storageBucket: "willy0s-parallel-arena.appspot.com",
      messagingSenderId: "683284732830",
      appId: "1:683284732830:web:ef7fb4cf1c88f73eead48f",
      measurementId: "G-85B8R4NKNM"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const perf = firebase.performance();

    // ===================== OBSERVATION DES PERFORMANCES =====================
    if ('PerformanceObserver' in window) {
      const paintObserver = new PerformanceObserver(list => {
        const fcp = list.getEntriesByName('first-contentful-paint')[0];
        if (fcp) console.log('FCP:', fcp.startTime, 'ms');
      });
      paintObserver.observe({ type: 'paint', buffered: true });
      
      const fidObserver = new PerformanceObserver(list => {
        list.getEntries().forEach(entry => {
          if (entry.entryType === 'first-input') {
            console.log('FID:', entry.processingStart - entry.startTime, 'ms');
          }
        });
      });
      fidObserver.observe({ type: 'first-input', buffered: true });
    }

    // ===================== GESTION DE LA MAINTENANCE =====================
    const maintenanceStartRef = database.ref('maintenance/start');
    const maintenanceEndRef = database.ref('maintenance/end'); 

    function checkMaintenance() {
      Promise.all([maintenanceStartRef.once('value'), maintenanceEndRef.once('value')])
        .then(([startSnap, endSnap]) => {
          const maintenanceStart = new Date(startSnap.val());
          const maintenanceEnd = new Date(endSnap.val());
          const currentTime = new Date();
          if (maintenanceStart && maintenanceEnd && currentTime >= maintenanceStart && currentTime <= maintenanceEnd) {
            window.location.href = 'maintenance.html';
          }
        })
        .catch(error => console.error("Erreur lors de la récupération des données de maintenance:", error));
    }
    checkMaintenance();
    setInterval(checkMaintenance, 10000);

    // ===================== NAVIGATION =====================
    function viewCharacters() { window.location.href = "perso_stats.html"; }
    function viewShop() { window.location.href = "boutique.html"; }
    function viewUpgrades() { window.location.href = "amelioration.html"; }
    function showMainMenu() { window.location.href = "menu_principal.html"; }
    function goToPasse() { window.location.href = "passe.html"; }

    function StartedGame() {
      const userData = getUserData();
      if (userData.partie_commencee) {
        window.location.href="../combat.html";
      }  else if (userData.partie_commencee_weekend) {
        window.location.href="../combat-weekend.html";
      }
    }
    StartedGame();

    // ===================== PASS PREMIUM =====================
    function showPopup() {
      document.getElementById('ad-popup').style.display = 'block';
    }
    function hidePopup() {
      document.getElementById('ad-popup').style.display = 'none';
    }
    function handlePurchase() {
      hidePopup();
      const userData = getUserData();
      const loadingPopup = document.getElementById('loading-popup');
      loadingPopup.style.display = 'block';
      loadingPopup.classList.add('active');
      setTimeout(() => {
        if (userData.argent >= 1050) {
          userData.argent -= 1050;
          userData.pass_premium = true;
          userData.pass_XP += 500;
          saveUserData(userData);
          alert('Achat réussi, le Parallel Pass 3 Premium est maintenant disponible !');
          alert('En cadeau, vous recevez 500 XP supplémentaire !');
          location.reload();
        } else {
          alert('Points insuffisants pour effectuer cet achat.');
        }
        loadingPopup.classList.remove('active');
        setTimeout(() => loadingPopup.style.display = 'none', 2000);
      }, 2000);
    }

    // ===================== GESTION DES NIVEAUX ET RECOMPENSES =====================
    document.addEventListener('DOMContentLoaded', () => {
      const userData = JSON.parse(localStorage.getItem('userData'));
      const albumContainer = document.getElementById('album-container');
      const prevPageBtn = document.getElementById('prevPage');
      const nextPageBtn = document.getElementById('nextPage');
      const xpProgressBar = document.querySelector('.xp-progress-bar');
      const xpProgressText = document.getElementById('xp-progress-text');

      // Calcule les XP pour le prochain niveau
      function calculateNextLevelXP(level) {
        return Math.round((50 + (level * 20)) * 1.1);
      }
      // Met à jour l'affichage du niveau et la barre de progression
      function updateLevelInfo() {
        const currentLevel = userData.pass_level;
        const currentXP = userData.pass_XP;
        const nextLevelXP = calculateNextLevelXP(currentLevel);
        const xpPercentage = (currentXP / nextLevelXP) * 100;
        xpProgressText.textContent = `XP: ${currentXP} / ${nextLevelXP}`;
        xpProgressBar.style.width = `${xpPercentage}%`;
        document.getElementById('current-level').textContent = currentLevel;
        document.getElementById('next-level').textContent = currentLevel + 1;
      }
      // Vérifie et applique les level-ups
      function checkLevelUp() {
        let levelGained = false;
        while (userData.pass_XP >= calculateNextLevelXP(userData.pass_level)) {
          const nextXP = calculateNextLevelXP(userData.pass_level);
          userData.pass_level++;
          userData.pass_XP -= nextXP;
          levelGained = true;
        }
        if (levelGained) {
          saveUserData(userData);
          updateLevelInfo();
          alert(`Félicitations ! Vous avez atteint le niveau ${userData.pass_level}.`);
        }
      }
      checkLevelUp();
      updateLevelInfo();

      // Listes des récompenses
      const freeRewards = [
        {badge: 1, text: "5 Points", level: 1, type: 'points', value: 5, rarity: 'simple'},
        {badge: 2, text: "2 Potions de santé", level: 2, type: 'potion_sante', value: 2, rarity: 'simple'},
        {badge: 3, text: "Double XP", level: 3, type: 'Double_XP', value: 1, rarity: 'simple'},
        {badge: 4, text: "10 Points", level: 4, type: 'points', value: 10, rarity: 'simple'},
        {badge: 5, text: "Bouclier solide", level: 5, type: 'bouclier_solide', value: 1, rarity: 'simple'},
        {badge: 6, text: "15 Points", level: 6, type: 'points', value: 15, rarity: 'simple'},
        {badge: 7, text: "2 Épées tranchantes", level: 7, type: 'epee_tranchante', value: 2, rarity: 'simple'},
        {badge: 8, text: "Élixir de puissance", level: 8, type: 'elixir_puissance', value: 1, rarity: 'simple'},
        {badge: 9, text: "10 Points", level: 9, type: 'points', value: 10, rarity: 'simple'},
        {badge: 10, text: "Amulette de régénération", level: 10, type: 'amulette_regeneration', value: 1, rarity: 'simple'},
        {badge: 11, text: "15 Points", level: 11, type: 'points', value: 15, rarity: 'simple'},
        {badge: 12, text: "2 Potions de santé", level: 12, type: 'potion_sante', value: 2, rarity: 'simple'},
        {badge: 13, text: "2 Double XP", level: 13, type: 'Double_XP', value: 2, rarity: 'simple'},
        {badge: 14, text: "10 Points", level: 14, type: 'points', value: 10, rarity: 'simple'},
        {badge: 15, text: "2 Boucliers solides", level: 15, type: 'bouclier_solide', value: 2, rarity: 'simple'},
        {badge: 16, text: "20 Points", level: 16, type: 'points', value: 20, rarity: 'simple'},
        {badge: 17, text: "Cape de l’ombre", level: 17, type: 'cape_ombre', value: 1, rarity: 'simple'},
        {badge: 18, text: "10 Points", level: 18, type: 'points', value: 10, rarity: 'simple'},
        {badge: 19, text: "Élixir de puissance", level: 19, type: 'elixir_puissance', value: 1, rarity: 'simple'},
        {badge: 20, text: "Amulette de régénération", level: 20, type: 'amulette_regeneration', value: 1, rarity: 'simple'},
        {badge: 21, text: "10 Points", level: 21, type: 'points', value: 10, rarity: 'simple'},
        {badge: 22, text: "Armure de fer", level: 22, type: 'armure_fer', value: 1, rarity: 'simple'},
        {badge: 23, text: "2 Épées tranchantes", level: 23, type: 'epee_tranchante', value: 2, rarity: 'simple'},
        {badge: 24, text: "10 Points", level: 24, type: 'points', value: 10, rarity: 'simple'},
        {badge: 25, text: "Crystal de renouveau", level: 25, type: 'crystal_renouveau', value: 1, rarity: 'simple'},
        {badge: 26, text: "15 Points", level: 26, type: 'points', value: 15, rarity: 'simple'},
        {badge: 27, text: "Double XP", level: 27, type: 'Double_XP', value: 1, rarity: 'simple'},
        {badge: 28, text: "2 Potions de santé", level: 28, type: 'potion_sante', value: 2, rarity: 'simple'},
        {badge: 29, text: "Élixir de puissance", level: 29, type: 'elixir_puissance', value: 1, rarity: 'simple'},
        {badge: 30, text: "10 Points", level: 30, type: 'points', value: 10, rarity: 'simple'},
        {badge: 31, text: "20 Points", level: 31, type: 'points', value: 20, rarity: 'simple'},
        {badge: 32, text: "Bouclier solide", level: 32, type: 'bouclier_solide', value: 1, rarity: 'simple'},
        {badge: 33, text: "2 Épées tranchantes", level: 33, type: 'epee_tranchante', value: 2, rarity: 'simple'},
        {badge: 34, text: "10 Points", level: 34, type: 'points', value: 10, rarity: 'simple'},
        {badge: 35, text: "Amulette de régénération", level: 35, type: 'amulette_regeneration', value: 1, rarity: 'simple'},
        {badge: 36, text: "10 Points", level: 36, type: 'points', value: 10, rarity: 'simple'},
        {badge: 37, text: "Armure de fer", level: 37, type: 'armure_fer', value: 1, rarity: 'simple'},
        {badge: 38, text: "Crystal de renouveau", level: 38, type: 'crystal_renouveau', value: 1, rarity: 'simple'},
        {badge: 39, text: "2 Potions de santé", level: 39, type: 'potion_sante', value: 2, rarity: 'simple'},
        {badge: 40, text: "10 Points", level: 40, type: 'points', value: 10, rarity: 'simple'},
        {badge: 41, text: "15 Points", level: 41, type: 'points', value: 15, rarity: 'simple'},
        {badge: 42, text: "Élixir de puissance", level: 42, type: 'elixir_puissance', value: 1, rarity: 'simple'},
        {badge: 43, text: "2 Double XP", level: 43, type: 'Double_XP', value: 2, rarity: 'simple'},
        {badge: 44, text: "10 Points", level: 44, type: 'points', value: 10, rarity: 'simple'},
        {badge: 45, text: "2 Boucliers solides", level: 45, type: 'bouclier_solide', value: 2, rarity: 'simple'},
        {badge: 46, text: "20 Points", level: 46, type: 'points', value: 20, rarity: 'simple'},
        {badge: 47, text: "Cape de l’ombre", level: 47, type: 'cape_ombre', value: 1, rarity: 'simple'},
        {badge: 48, text: "10 Points", level: 48, type: 'points', value: 10, rarity: 'simple'},
        {badge: 49, text: "Amulette de régénération", level: 49, type: 'amulette_regeneration', value: 1, rarity: 'simple'},
        {badge: 50, text: "2 Potions de santé", level: 50, type: 'potion_sante', value: 2, rarity: 'simple'},
        {badge: 51, text: "10 Points", level: 51, type: 'points', value: 10, rarity: 'simple'},
        {badge: 52, text: "Crystal de renouveau", level: 52, type: 'crystal_renouveau', value: 1, rarity: 'simple'},
        {badge: 53, text: "Double XP", level: 53, type: 'Double_XP', value: 1, rarity: 'simple'},
        {badge: 54, text: "10 Points", level: 54, type: 'points', value: 10, rarity: 'simple'},
        {badge: 55, text: "Élixir de puissance", level: 55, type: 'elixir_puissance', value: 1, rarity: 'simple'},
        {badge: 56, text: "Amulette de régénération", level: 56, type: 'amulette_regeneration', value: 1, rarity: 'simple'},
        {badge: 57, text: "2 Boucliers solides", level: 57, type: 'bouclier_solide', value: 2, rarity: 'simple'},
        {badge: 58, text: "10 Points", level: 58, type: 'points', value: 10, rarity: 'simple'},
        {badge: 59, text: "Cape de l’ombre", level: 59, type: 'cape_ombre', value: 1, rarity: 'simple'},
        {badge: 60, text: "5 Récompenses aléatoires", level: 60, type: 'recompense', value: 5, rarity: 'simple'}
      ];
      const premiumRewards = [
        {badge: 1, text: "10 Points", level: 1, type: 'points', value: 10, rarity: 'premium'},
        {badge: 2, text: "3 Potions de santé", level: 2, type: 'potion_sante', value: 3, rarity: 'premium'},
        {badge: 3, text: "2 Double XP", level: 3, type: 'double_xp', value: 2, rarity: 'premium'},
        {badge: 4, text: "20 Points", level: 4, type: 'points', value: 20, rarity: 'premium'},
        {badge: 5, text: "2 Boucliers solides", level: 5, type: 'bouclier_solide', value: 2, rarity: 'premium'},
        {badge: 6, text: "20 Points", level: 6, type: 'points', value: 20, rarity: 'premium'},
        {badge: 7, text: "3 Épées tranchantes", level: 7, type: 'epee_tranchante', value: 3, rarity: 'premium'},
        {badge: 8, text: "2 Élixirs de puissance", level: 8, type: 'elixir_puissance', value: 2, rarity: 'premium'},
        {badge: 9, text: "15 Points", level: 9, type: 'points', value: 15, rarity: 'premium'},
        {badge: 10, text: "Amulette de régénération", level: 10, type: 'amulette_regeneration', rarity: 'premium'},
        {badge: 11, text: "20 Points", level: 11, type: 'points', value: 20, rarity: 'premium'},
        {badge: 12, text: "3 Potions de santé", level: 12, type: 'potion_sante', value: 3, rarity: 'premium'},
        {badge: 13, text: "3 Double XP", level: 13, type: 'double_xp', value: 3, rarity: 'premium'},
        {badge: 14, text: "15 Points", level: 14, type: 'points', value: 15, rarity: 'premium'},
        {badge: 15, text: "3 Boucliers solides", level: 15, type: 'bouclier_solide', value: 3, rarity: 'premium'},
        {badge: 16, text: "30 Points", level: 16, type: 'points', value: 30, rarity: 'premium'},
        {badge: 17, text: "Cape de l’ombre", level: 17, type: 'cape_ombre', rarity: 'premium'},
        {badge: 18, text: "15 Points", level: 18, type: 'points', value: 15, rarity: 'premium'},
        {badge: 19, text: "2 Élixirs de puissance", level: 19, type: 'elixir_puissance', value: 2, rarity: 'premium'},
        {badge: 20, text: "Amulette de régénération", level: 20, type: 'amulette_regeneration', rarity: 'premium'},
        {badge: 21, text: "15 Points", level: 21, type: 'points', value: 15, rarity: 'premium'},
        {badge: 22, text: "Armure de fer", level: 22, type: 'armure_fer', rarity: 'premium'},
        {badge: 23, text: "3 Épées tranchantes", level: 23, type: 'epee_tranchante', value: 3, rarity: 'premium'},
        {badge: 24, text: "15 Points", level: 24, type: 'points', value: 15, rarity: 'premium'},
        {badge: 25, text: "Cristal de renouveau", level: 25, type: 'cristal_renouveau', rarity: 'premium'},
        {badge: 26, text: "20 Points", level: 26, type: 'points', value: 20, rarity: 'premium'},
        {badge: 27, text: "3 Double XP", level: 27, type: 'double_xp', value: 3, rarity: 'premium'},
        {badge: 28, text: "3 Potions de santé", level: 28, type: 'potion_sante', value: 3, rarity: 'premium'},
        {badge: 29, text: "2 Élixirs de puissance", level: 29, type: 'elixir_puissance', value: 2, rarity: 'premium'},
        {badge: 30, text: "15 Points", level: 30, type: 'points', value: 15, rarity: 'premium'},
        {badge: 31, text: "30 Points", level: 31, type: 'points', value: 30, rarity: 'premium'},
        {badge: 32, text: "2 Boucliers solides", level: 32, type: 'bouclier_solide', value: 2, rarity: 'premium'},
        {badge: 33, text: "3 Épées tranchantes", level: 33, type: 'epee_tranchante', value: 3, rarity: 'premium'},
        {badge: 34, text: "15 Points", level: 34, type: 'points', value: 15, rarity: 'premium'},
        {badge: 35, text: "Amulette de régénération", level: 35, type: 'amulette_regeneration', rarity: 'premium'},
        {badge: 36, text: "20 Points", level: 36, type: 'points', value: 20, rarity: 'premium'},
        {badge: 37, text: "Armure de fer", level: 37, type: 'armure_fer', rarity: 'premium'},
        {badge: 38, text: "Cristal de renouveau", level: 38, type: 'cristal_renouveau', rarity: 'premium'},
        {badge: 39, text: "3 Potions de santé", level: 39, type: 'potion_sante', value: 3, rarity: 'premium'},
        {badge: 40, text: "15 Points", level: 40, type: 'points', value: 15, rarity: 'premium'},
        {badge: 41, text: "20 Points", level: 41, type: 'points', value: 20, rarity: 'premium'},
        {badge: 42, text: "2 Élixirs de puissance", level: 42, type: 'elixir_puissance', value: 2, rarity: 'premium'},
        {badge: 43, text: "3 Double XP", level: 43, type: 'double_xp', value: 3, rarity: 'premium'},
        {badge: 44, text: "15 Points", level: 44, type: 'points', value: 15, rarity: 'premium'},
        {badge: 45, text: "3 Boucliers solides", level: 45, type: 'bouclier_solide', value: 3, rarity: 'premium'},
        {badge: 46, text: "30 Points", level: 46, type: 'points', value: 30, rarity: 'premium'},
        {badge: 47, text: "Cape de l’ombre", level: 47, type: 'cape_ombre', rarity: 'premium'},
        {badge: 48, text: "15 Points", level: 48, type: 'points', value: 15, rarity: 'premium'},
        {badge: 49, text: "Amulette de régénération", level: 49, type: 'amulette_regeneration', rarity: 'premium'},
        {badge: 50, text: "3 Potions de santé", level: 50, type: 'potion_sante', value: 3, rarity: 'premium'},
        {badge: 51, text: "15 Points", level: 51, type: 'points', value: 15, rarity: 'premium'},
        {badge: 52, text: "Cristal de renouveau", level: 52, type: 'cristal_renouveau', rarity: 'premium'},
        {badge: 53, text: "2 Double XP", level: 53, type: 'double_xp', value: 2, rarity: 'premium'},
        {badge: 54, text: "15 Points", level: 54, type: 'points', value: 15, rarity: 'premium'},
        {badge: 55, text: "2 Élixirs de puissance", level: 55, type: 'elixir_puissance', value: 2, rarity: 'premium'},
        {badge: 56, text: "20 Points", level: 56, type: 'points', value: 20, rarity: 'premium'},
        {badge: 57, text: "3 Épées tranchantes", level: 57, type: 'epee_tranchante', value: 3, rarity: 'premium'},
        {badge: 58, text: "3 Boucliers solides", level: 58, type: 'bouclier_solide', value: 3, rarity: 'premium'},
        {badge: 59, text: "30 Points", level: 59, type: 'points', value: 30, rarity: 'premium'},
        {badge: 60, text: "7 récompenses aléatoires + L'inconnu", level: 60, type: 'recompense', value: 7, rarity: 'premium'}
      ];
      const rewardsPerPage = 3;
      const totalPages = Math.max(
        Math.ceil(freeRewards.length / rewardsPerPage),
        Math.ceil(premiumRewards.length / rewardsPerPage)
      );
      let pages = [];
      let currentPageIndex = 0;

      // Crée un élément de récompense
      function createRewardElement(reward) {
        const div = document.createElement('div');
        div.className = `reward ${reward.rarity}`;
        div.dataset.badge = reward.badge;
        div.dataset.level = reward.level;
        div.dataset.rarity = reward.rarity;
        // Vérification de la récupération
        const redeemed = (reward.rarity === 'simple' && userData[`free_${reward.badge}`]) ||
                         (reward.rarity === 'premium' && userData[`premium_${reward.badge}`]);
        if (redeemed) { div.classList.add('redeemed'); }
        div.innerHTML = `
          <div class="badge">${reward.badge}</div>
          ${reward.text}
          <div class="error-message hidden" id="error-${reward.badge}">Vous n'avez pas atteint le niveau nécessaire.</div>
        `;
        return div;
      }
      // Crée une page de récompenses
      function createPage(pageIndex) {
        const page = document.createElement('div');
        page.className = 'page';
        const freeContainer = document.createElement('div');
        freeContainer.className = 'free-rewards';
        const premiumContainer = document.createElement('div');
        premiumContainer.className = 'premium-rewards';
        const freeTitle = document.createElement('h2');
        freeTitle.textContent = 'Récompenses Gratuites';
        freeTitle.className = 'rewards-title';
        freeContainer.appendChild(freeTitle);
        const premiumTitle = document.createElement('h2');
        premiumTitle.textContent = 'Récompenses Premium';
        premiumTitle.className = 'rewards-title';
        premiumContainer.appendChild(premiumTitle);
        const freeStart = pageIndex * rewardsPerPage;
        for (let i = freeStart; i < freeStart + rewardsPerPage && i < freeRewards.length; i++) {
          freeContainer.appendChild(createRewardElement(freeRewards[i]));
        }
        const premiumStart = pageIndex * rewardsPerPage;
        for (let i = premiumStart; i < premiumStart + rewardsPerPage && i < premiumRewards.length; i++) {
          const elem = createRewardElement(premiumRewards[i]);
          elem.classList.add('premium');
          premiumContainer.appendChild(elem);
        }
        page.appendChild(freeContainer);
        page.appendChild(premiumContainer);
        freeContainer.style.float = 'left';
        premiumContainer.style.float = 'right';
        return page;
      }
      // Ajoute les pages au conteneur
      for (let i = 0; i < totalPages; i++) {
        const page = createPage(i);
        albumContainer.appendChild(page);
        pages.push(page);
      }
      // Affiche la page courante
      function showPage(index) {
        pages.forEach((page, i) => page.classList.toggle('active', i === index));
        prevPageBtn.classList.toggle('hidden', index === 0);
        nextPageBtn.classList.toggle('hidden', index === totalPages - 1);
      }
      prevPageBtn.addEventListener('click', () => {
        if (currentPageIndex > 0) { currentPageIndex--; showPage(currentPageIndex); }
      });
      nextPageBtn.addEventListener('click', () => {
        if (currentPageIndex < totalPages - 1) { currentPageIndex++; showPage(currentPageIndex); }
      });
      // Gestion du clic sur une récompense
      albumContainer.addEventListener('click', event => {
        const rewardElement = event.target.closest('.reward');
        if (!rewardElement) return;
        const badge = rewardElement.dataset.badge;
        const badgeRarity = rewardElement.dataset.rarity;
        const levelRequired = parseInt(rewardElement.dataset.level);
        const errorElement = document.getElementById(`error-${badge}`);
        let free = false, premium = false;
        if (userData.pass_level >= levelRequired) {
          let reward;
          if (badgeRarity === 'simple') {
            reward = freeRewards.find(r => r.badge === parseInt(badge));
            free = true;
          } else if (badgeRarity === 'premium') {
            reward = premiumRewards.find(r => r.badge === parseInt(badge));
            premium = true;
            if (!userData.pass_premium) {
              showPopup();
              return;
            }
          }
          if (reward && ((free && !userData[`free_${badge}`]) || (premium && !userData[`premium_${badge}`]))) {
            // Attribution de la récompense
            switch(reward.type) {
              case 'points':
                userData.argent = (userData.argent || 0) + reward.value;
                break;
              case 'potion_sante':
                userData.Potion_de_Santé_acheté = (userData.Potion_de_Santé_acheté || 0) + (reward.value || 1);
                break;
              case 'amulette_regeneration':
                userData.Amulette_de_Régénération_acheté = (userData.Amulette_de_Régénération_acheté || 0) + (reward.value || 1);
                break;
              case 'epee_tranchante':
                userData.epee_tranchante_acheté = (userData.epee_tranchante_acheté || 0) + (reward.value || 1);
                break;
              case 'elixir_puissance':
                userData.elixir_puissance_acheté = (userData.elixir_puissance_acheté || 0) + (reward.value || 1);
                break;
              case 'armure_fer':
                userData.armure_fer_acheté = (userData.armure_fer_acheté || 0) + (reward.value || 1);
                break;
              case 'Double_XP':
                userData.Double_XP_acheté = (userData.Double_XP_acheté || 0) + (reward.value || 1);
                break;
              case 'Personnage':
                userData.Inconnu = 1;
                break;
              case 'recompense':
                userData.recompense = (userData.recompense || 0) + (reward.value || 1);
                break;
              case 'bouclier_solide':
                userData.bouclier_solide_acheté = (userData.bouclier_solide_acheté || 0) + (reward.value || 1);
                break;
              case 'cape_ombre':
                userData.Cape_acheté = (userData.Cape_acheté || 0) + (reward.value || 1);
                break;
              case 'crystal_renouveau':
                userData.crystal_acheté = (userData.crystal_acheté || 0) + (reward.value || 1);
                break;
              default:
                break;
            }
            if (badgeRarity === 'simple') {
              userData[`free_${badge}`] = true;
            } else if (badgeRarity === 'premium') {
              userData[`premium_${badge}`] = true;
            }
            saveUserData(userData);
            rewardElement.classList.add('redeemed');
          }
        } else {
          rewardElement.classList.add('shake');
          errorElement.classList.remove('hidden');
          setTimeout(() => rewardElement.classList.remove('shake'), 500);
        }
      });
      showPage(currentPageIndex);
      
      // Fonction locale de sauvegarde des données
      function saveUserData(userData) {
        const connection = JSON.parse(localStorage.getItem('connection'));
        localStorage.setItem('userData', JSON.stringify(userData));
        if (connection && connection.est_connecte) {
          const userRef = database.ref(`users/${connection.userid}/userData`);
          userRef.set(userData, error => {
            if (error) console.error("Erreur lors de l'enregistrement dans Firebase:", error);
            else console.log("Données utilisateur sauvegardées dans Firebase");
          });
        }
      }
    });

    // Mise à jour finale du pass "Inconnu"
    let userData = getUserData();
    if (userData.pass_level >= 60 && userData.pass_premium && userData.Inconnu != 1) {
      userData.Inconnu = 1;
    }
    saveUserData(userData);
  </script>
</body>
</html>