<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Sélection de personnage</title>
  <style>
    body {
      text-align: center;
      font-family: 'Arial', sans-serif;
      background: url('background2.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }
    h2 {
      font-size: 36px;
      margin-top: 50px;
      text-shadow: 2px 2px 4px #000000;
    }
    .character-button {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      background-color: #ff4500;
      color: #ffffff;
      border-radius: 5px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s, transform 0.3s;
      width: 150px;
      height: 50px;
      line-height: 30px; /* Ajuster pour centrer verticalement le texte */
      position: relative;
    }
    .character-button:hover {
      background-color: #e03e00;
      transform: scale(1.05);
    }
    .character-button.disabled {
      background-color: #a9a9a9;
      cursor: not-allowed;
    }
    .character-button.shake {
      animation: shake 0.5s;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .unlock-message {
      color: #ff4500;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .unlock-message.show {
      display: block;
      animation: slideIn 0.5s;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .stats {
      margin: 20px auto;
      padding: 10px;
      width: 200px;
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 5px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 1s ease-out, opacity 1s ease-out;
    }
    .stats.show {
      opacity: 1;
      max-height: 220px; /* Ajuster en fonction du contenu */
    }
    .choose-button {
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      background-color: #32cd32;
      color: #ffffff;
      border-radius: 5px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s, transform 0.3s;
    }
    .choose-button:hover {
      background-color: #28a428;
      transform: scale(1.05);
    }
    /* Styles pour le thème sombre */
    .dark-theme {
      background: #121212;
      color: #e0e0e0;
    }

    .dark-theme h2 {
      color: #e0e0e0;
      text-shadow: 2px 2px 4px #000000;
    }

    .dark-theme .character-button {
      background-color: #333333; /* Couleur de base pour les boutons en mode sombre */
      color: #e0e0e0;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
    }

    .dark-theme .character-button:hover {
      background-color: #555555; /* Couleur plus claire pour le survol */
    }

    .dark-theme .character-button.disabled {
      background-color: #666666; /* Gris pour les boutons désactivés */
    }

    .dark-theme .unlock-message {
      color: #ffb74d; /* Orange atténué pour les messages de déblocage */
    }

    .dark-theme .choose-button {
      background-color: #4caf50; /* Une couleur verte atténuée */
      color: #e0e0e0;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
    }

    .dark-theme .choose-button:hover {
      background-color: #388e3c; /* Plus foncé pour le survol */
    }

    .dark-theme .stats {
      background-color: rgba(33, 33, 33, 0.9);
      color: #e0e0e0;
      border: 1px solid #555555; /* Bordure pour les stats */
    }

    .dark-theme .stats::-webkit-scrollbar {
      width: 12px;
    }

    .dark-theme .stats::-webkit-scrollbar-track {
      background: #1c1c1c; /* Couleur de l'arrière-plan du défilement */
    }

    .dark-theme .stats::-webkit-scrollbar-thumb {
      background: #555555; /* Couleur du curseur de défilement */
    }

    .dark-theme .stats::-webkit-scrollbar-thumb:hover {
      background: #777777; /* Couleur du curseur de défilement au survol */
    }
  </style>
</head>
<body>
  <h2>Choisissez un personnage</h2>
  <div id="character-list">
    <!-- Les boutons des personnages seront ajoutés dynamiquement ici -->
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Récupérer les données utilisateur depuis localStorage
      const userData = getUserData();
      console.log(userData); // Utilisez userData pour afficher ou manipuler les détails spécifiques à l'utilisateur

      // Liste des personnages avec leurs caractéristiques de base
      const characters = [
        { name: "Willy", pv: 11200, attaque: 470, defense: 80, spe: 0.5, argent: 0, pv_max: 11200, attaque_originale: 470, defense_originale: 80 },
        { name: "Cocobi", pv: 10800, attaque: 440, defense: 115, spe: 0.5, argent: 0, pv_max: 10800, attaque_originale: 440, defense_originale: 115 },
        { name: "Oiseau", pv: 9800, attaque: 510, defense: 85, spe: 0.5, argent: 0, pv_max: 9800, attaque_originale: 510, defense_originale: 85 },
        { name: "Gros Nounours", pv: 13000, attaque: 430, defense: 68, spe: 0.5, argent: 0, pv_max: 1300, attaque_originale: 430, defense_originale: 68 },
        { name: "Baleine", pv: 10500, attaque: 430, defense: 115, spe: 0.5, argent: 0, pv_max: 10500, attaque_originale: 430, defense_originale: 115 },
        { name: "Doudou", pv: 13800, attaque: 350, defense: 80, spe: 0, argent: 0, pv_max: 13800, attaque_originale: 350, defense_originale: 80 },
        { name: "Coeur", pv: 10000, attaque: 450, defense: 100, spe: 0.5, argent: 0, pv_max: 10000, attaque_originale: 450, defense_originale: 100 },
        { name: "Diva", pv: 10700, attaque: 440, defense: 100, spe: 0.5, argent: 0, pv_max: 10700, attaque_originale: 440, defense_originale: 100 },
        { name: "Poulpy", pv: 11500, attaque: 440, defense: 100, spe: 0.5, argent: 0, pv_max: 11500, attaque_originale: 440, defense_originale: 100 },
        { name: "Colorina", pv: 9600, attaque: 420, defense: 80, spe: 0.5, argent: 0, pv_max: 9600, attaque_originale: 420, defense_originale: 80 }
      ];

      const characterList = document.getElementById("character-list");
      let playerCharacter = null;

      // Pour chaque personnage, créer un bouton dynamiquement
      characters.forEach((character, index) => {
        const button = document.createElement("button");
        button.classList.add("character-button");
        button.textContent = character.name;

        // Vérifier si le personnage est débloqué ou non
        if (userData[character.name] === 1) {
          button.style.backgroundColor = "#ff4500"; // Mettre en orange
          button.onclick = function() {
            playerCharacter = character;
            displayStats(button, playerCharacter);
            checkAndAskForUsername(); // Vérifier et demander le pseudo après avoir choisi un personnage
          };
        } else {
          button.classList.add("disabled"); // Mettre en gris
          button.onclick = function() {
            button.classList.add("shake");
            setTimeout(() => button.classList.remove("shake"), 500);

            let unlockMessage = button.nextElementSibling;
            if (!unlockMessage || !unlockMessage.classList.contains('unlock-message')) {
              unlockMessage = document.createElement('div');
              unlockMessage.classList.add('unlock-message');
              unlockMessage.textContent = "Ce personnage n'est pas encore débloqué !";
              button.parentNode.insertBefore(unlockMessage, button.nextSibling);
            }
            unlockMessage.classList.add('show');
          };
        }

        characterList.appendChild(button);
      });

      // Fonction pour afficher les statistiques du personnage sélectionné
      function displayStats(button, character) {
        // Supprimer tout élément de statistiques existant
        const existingStats = document.querySelectorAll('.stats');
        existingStats.forEach(stats => stats.remove());

        // Créer un nouvel élément de statistiques
        const statsDiv = document.createElement('div');
        statsDiv.classList.add('stats');

        // Calculer les statistiques basées sur le niveau actuel du personnage
        const levelKey = character.name + '_Level';
        const currentLevel = userData[levelKey];
        let increasedPV = Math.round(character.pv * (1 + 0.08 * (currentLevel - 1)));
        let increasedAttaque = Math.round(character.attaque * (1 + 0.08 * (currentLevel - 1)));
        let increasedDefense = Math.round(character.defense * (1 + 0.08 * (currentLevel - 1)));
        let increasedattaque_originale = Math.round(character.attaque_originale * (1 + 0.08 * (currentLevel - 1)));
        let increaseddefense_originale = Math.round(character.defense_originale * (1 + 0.08 * (currentLevel - 1)));

        if (currentLevel >= 5) {
          const boostType = Math.floor(Math.random() * 3) + 1;
          if (boostType === 1) {
            increasedAttaque = Math.round(increasedAttaque * 1.02);
            increasedattaque_originale = increasedAttaque;
          } else if (boostType === 2) {
            increasedDefense = Math.round(increasedDefense * 1.02);
            increaseddefense_originale = increasedDefense;
          } else if (boostType === 3) {
            increasedPV = Math.round(increasedPV * 1.02);
          }
        }

        statsDiv.innerHTML = `
          <h3>${character.name} (Niveau ${currentLevel})</h3>
          <p>PV: ${increasedPV}</p>
          <p>Attaque: ${increasedAttaque}</p>
          <p>Défense: ${increasedDefense}</p>

          <button class="choose-button" onclick="chooseCharacter('${character.name}', ${increasedPV}, ${increasedAttaque}, ${increasedDefense},
  ${character.spe}, ${character.argent}, ${character.pv_max}, ${increasedattaque_originale}, ${increaseddefense_originale})">Choisir</button>`;

        // Insérer l'élément de statistiques après le bouton cliqué
        button.parentNode.insertBefore(statsDiv, button.nextSibling);

        // Déclencher un reflow pour la transition CSS
        statsDiv.offsetHeight; // Ceci est pour recharger la page et appliquer la transition

        // Ajouter la classe show pour déclencher l'animation
        statsDiv.classList.add('show');
      }

      // Vérifier et demander le pseudo si nécessaire
      function checkAndAskForUsername() {
        let pseudo = userData.pseudo;
        if (!pseudo) {
          pseudo = prompt("Veuillez entrer votre pseudo:");
          if (pseudo) {
            userData.pseudo = pseudo;
            localStorage.setItem('userData', JSON.stringify(userData));
          }
        }
      }

      window.chooseCharacter = function(name, pv, attaque, defense, spe, argent, pv_max, attaque_originale, defense_originale) {
        sessionStorage.setItem('playerCharacter', JSON.stringify({ name, pv, attaque, defense, spe, argent, pv_max, attaque_originale, defense_originale }));

        // Sélection aléatoire d'un adversaire parmi les autres personnages
        const remainingCharacters = characters.filter(character => character.name !== name);
        const randomIndex = Math.floor(Math.random() * remainingCharacters.length);
        const opponentCharacter = remainingCharacters[randomIndex];

        // Déterminer le niveau de l'adversaire aléatoirement entre (player level - 1) et (player level + 2)
        const levelKey = name + '_Level';
        const playerLevel = userData[levelKey];
        const minOpponentLevel = Math.max(1, playerLevel - 1); // Le niveau de l'adversaire ne peut pas être inférieur à 1
        const maxOpponentLevel = playerLevel + 1;
        const opponentLevel = Math.floor(Math.random() * (maxOpponentLevel - minOpponentLevel + 1)) + minOpponentLevel;

        // Calculer les statistiques de l'adversaire basées sur son niveau
        let increasedOpponentPV = Math.round(opponentCharacter.pv * (1 + 0.08 * (opponentLevel - 1)));
        let increasedOpponentAttaque = Math.round(opponentCharacter.attaque * (1 + 0.08 * (opponentLevel - 1)));
        let increasedOpponentDefense = Math.round(opponentCharacter.defense * (1 + 0.08 * (opponentLevel - 1)));
        let increasedattaque_originale = Math.round(opponentCharacter.attaque_originale * (1 + 0.08 * (opponentLevel - 1)));
        let increaseddefense_originale = Math.round(opponentCharacter.defense_originale * (1 + 0.08 * (opponentLevel - 1)));

        if (opponentLevel >= 5) {
          const boostType = Math.floor(Math.random() * 3) + 1;
          if (boostType === 1) {
            increasedOpponentAttaque = Math.round(increasedOpponentAttaque * 1.02);
            increasedattaque_originale = increasedOpponentAttaque;
          } else if (boostType === 2) {
            increasedOpponentDefense = Math.round(increasedOpponentDefense * 1.02);
            increaseddefense_originale = increasedOpponentDefense;
          } else if (boostType === 3) {
            increasedOpponentPV = Math.round(increasedOpponentPV * 1.02);
          }
        }

        sessionStorage.setItem('opponentCharacter', JSON.stringify({ name: opponentCharacter.name, pv: increasedOpponentPV, attaque: increasedOpponentAttaque, defense: increasedOpponentDefense, spe: opponentCharacter.spe, argent: opponentCharacter.argent, pv_max: opponentCharacter.pv_max, attaque_originale: increasedattaque_originale, defense_originale: increaseddefense_originale }));

        // Redirection vers la page de combat
        window.location.href = 'combat.html';
      }

    // Fonction pour récupérer les données utilisateur depuis localStorage
      function getUserData() {
      let userData = localStorage.getItem('userData');
        if (!userData) {
          // Initialiser les données utilisateur si elles n'existent pas encore
          userData = {
            nbr_perso: 2,
            victoires: 0,
            defaites: 0,
            trophees: 0,
            argent: 0,
            VICTOIRE: false,
            version: '2.0.0',
            recompense: 0,
            perso_recompense: 0,
            xp_du_jour: 0,
            Willy: 1,
            Willy_XP: 0,
            Willy_Level: 1,
            Willy_boost: 0,
            Cocobi: 1,
            Cocobi_XP: 0,
            Cocobi_Level: 1,
            Cocobi_boost: 0,
            Oiseau: 0,
            Oiseau_XP: 0,
            Oiseau_Level: 1,
            Oiseau_boost: 0,
            Gros_Nounours: 0,
            Gros_Nounours_XP: 0,
            Gros_Nounours_Level: 1,
            Gros_Nounours_boost: 0,
            Baleine: 0,
            Baleine_XP: 0,
            Baleine_Level: 1,
            Baleine_boost: 0,
            Doudou: 0,
            Doudou_XP: 0,
            Doudou_Level: 1,
            Doudou_boost: 0,
            Coeur: 0,
            Coeur_XP: 0,
            Coeur_Level: 1,
            Coeur_boost: 0,
            Diva: 0,
            Diva_XP: 0,
            Diva_Level: 1,
            Diva_boost: 0,
            Poulpy: 0,
            Poulpy_XP: 0,
            Poulpy_Level: 1,
            Poulpy_boost: 0,
            Colorina: 0,
            Colorina_XP: 0,
            Colorina_Level: 1,
            Colorina_boost: 0,
            Double_XP: 5,
            Double_XP_acheté: 0,
            Potion_de_Santé_acheté: 0,
            Amulette_de_Régénération_acheté: 0,
            lastDoubleXPCheck: 0,
            theme: false // Défaut clair
          };
          localStorage.setItem('userData', JSON.stringify(userData));
        } else {
          userData = JSON.parse(userData);
        }

        // Appliquer le thème sombre si nécessaire
        if (userData.theme) {
          document.body.classList.add('dark-theme');
        }

        return userData;
      }
    });
  </script>
</body>
</html>
