<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Willy0's Parallel Arena</title>
  <style>
    body {
      text-align: center;
      font-family: 'Arial', sans-serif;
      background-size: cover;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }
    .title {
      font-size: 48px;
      margin-bottom: 10px;
      padding-top: 10px;
      text-shadow: 2px 2px 4px #000000;
    }
    .title2 {
      font-size: 48px;
      margin-bottom: 20px;
      padding-top: 10px;
      text-shadow: 2px 2px 4px #000000;
    }
    .button-container {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .play-button-container {
      position: relative;
      width: 200px;
      margin-bottom: 10px; /* Espacement entre les boutons */
    }
    .play-button {
      padding: 15px 30px;
      font-size: 22px;
      cursor: pointer;
      border: none;
      background-color: #ff4500;
      color: #ffffff;
      border-radius: 5px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s, transform 0.3s;
      width: 100%; /* Largeur du bouton */
      text-align: center;
    }
    .play-button:hover {
      background-color: #e03e00;
      transform: scale(1.05);
    }
    .double-xp {
      position: absolute;
      top: -10px;
      right: -10px;
      background-color: yellow;
      color: red;
      padding: 5px;
      font-size: 12px;
      font-weight: bold;
      transform: rotate(15deg);
      border-radius: 3px;
      box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.3);
      display: none; /* Par défaut, ne pas afficher */
    }
    .view-data-button, .char-button, .shop-button {
      padding: 15px 30px;
      font-size: 22px;
      cursor: pointer;
      border: none;
      background-color: #ff4500;
      color: #ffffff;
      border-radius: 5px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s, transform 0.3s;
      margin-bottom: 10px; /* Espacement entre les boutons */
      width: 200px; /* Largeur des boutons */
      text-align: center;
    }
    .view-data-button:hover, .char-button:hover, .shop-button:hover {
      background-color: #e03e00;
      transform: scale(1.05);
    }
    .backup-button {
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      background-color: #4CAF50;
      color: #ffffff;
      border-radius: 3px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s, transform 0.3s;
      position: fixed;
      bottom: 10px;
      left: 10px;
    }
    .backup-button:hover {
      background-color: #45a049;
    }
    .contact-button {
      position: fixed;
      bottom: 10px;
      right: 10px;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
      border: none;
      background-color: #007bff; /* Couleur bleue */
      color: #ffffff;
      border-radius: 3px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      transition: background-color 0.3s, transform 0.3s;
    }
    .contact-button:hover {
      background-color: #0056b3; /* Changement de couleur au survol */
    }
    /* Style pour la boîte de dialogue */
    .dialog-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .dialog {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
    .dialog select {
      padding: 10px;
      font-size: 16px;
      margin: 10px 0;
    }
    .dialog button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      background-color: #007bff;
      color: #ffffff;
      border-radius: 5px;
      margin: 5px;
    }
    .dialog button:hover {
      background-color: #0056b3;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  

</head>
<body>
  <div class="title">Willy0's</div>
  <div class="title2">Parallel Arena</div>
  <div class="button-container">
    <div class="play-button-container">
      <span class="double-xp">Double XP !</span>
      <button class="play-button" onclick="startGame()">Jouer</button>
    </div>
    <button class="view-data-button" onclick="viewGameData()">Mes Stats</button>
    <button class="char-button" onclick="viewCharacters()">Personnages</button>
    <button class="shop-button" onclick="viewShop()">Boutique</button> <!-- Nouveau bouton ajouté -->
  </div>

  <script src="localStorage.js"></script> <!-- Lien vers votre script de gestion de localStorage -->

  <button class="backup-button" onclick="showImportOrSaveOptions()">Importer/Sauvegarder</button>
  <button class="contact-button" onclick="gofeedback()">Contactez le développeur</button>

  <script>
    const secretKey = 'votre_cle_secrete_ici'; // Clé de cryptage/décryptage

    function gofeedback() {
      window.location.href = "feed-back.html";
    }
    function startGame() {
      window.location.href = "characters.html"; // Redirection vers la page de sélection des personnages
    }

    function viewGameData() {
      window.location.href = "userdata.html"; // Redirection vers la page d'affichage des données utilisateur
    }

    function viewCharacters() {
      window.location.href = "perso_stats.html"; // Redirection vers la page d'affichage des personnages
    }

    function viewShop() {
      window.location.href = "boutique.html"; // Redirection vers la boutique
    }

    function showImportOrSaveOptions() {
      var choice = prompt("Que souhaitez-vous faire ?\n\n1. Importer une sauvegarde\n2. Sauvegarder les données actuelles\n\nEntrez 1, 2 ou Annuler pour quitter.");

      if (choice === "1") {
        importBackup();
      } else if (choice === "2") {
        downloadBackup();
      } else {
        // L'utilisateur a annulé l'action ou entré une valeur incorrecte
        return;
      }
    }

    function downloadBackup() {
      var userData = getUserData();
      var encryptedData = encrypt(JSON.stringify(userData)); // Cryptage des données utilisateur

      var blob = new Blob([encryptedData], { type: 'text/plain' });
      var url = URL.createObjectURL(blob);

      var a = document.createElement('a');
      a.href = url;
      a.download = 'Willy0_s_Parallel_Arena_backup.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importBackup() {
      var fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = '.txt'; // Spécifie le type de fichier attendu

      fileInput.onchange = function(event) {
        var file = event.target.files[0];
        if (!file) return;

        var reader = new FileReader();
        reader.onload = function(e) {
          var importedData = decrypt(e.target.result); // Décrypte les données importées

          try {
            var userData = JSON.parse(importedData);
            saveUserData(userData);
            alert('Sauvegarde importée avec succès !');
            location.reload(); // Recharge la page après importation
          } catch (error) {
            alert('Erreur lors de l\'importation de la sauvegarde.');
          }
        };

        reader.readAsText(file);
      };

      fileInput.click();
    }

    // Fonction de cryptage utilisant AES
    function encrypt(data) {
      return CryptoJS.AES.encrypt(data, secretKey).toString();
    }

    // Fonction de décryptage utilisant AES
    function decrypt(data) {
      var bytes = CryptoJS.AES.decrypt(data, secretKey);
      return bytes.toString(CryptoJS.enc.Utf8);
    }

    // Fonction pour obtenir les données utilisateur de localStorage
    function getUserData() {
      return JSON.parse(localStorage.getItem('userData'));
    }

    // Fonction pour sauvegarder les données utilisateur dans localStorage
    function saveUserData(userData) {
      localStorage.setItem('userData', JSON.stringify(userData));
    }

    function resetDoubleXPIfNeeded() {
      const now = new Date();
      const lastCheck = new Date(localStorage.getItem('lastDoubleXPCheck') || 0);
      const resetHour = 9; // 9h du matin
      const resetMinute = 0; // 30 minutes après 9h
      const userData = getUserData();

      // Vérifier si la dernière vérification était un jour différent
      if (now.getDate() !== lastCheck.getDate() || now.getMonth() !== lastCheck.getMonth() || now.getFullYear() !== lastCheck.getFullYear()) {
        if (now.getHours() > resetHour || (now.getHours() === resetHour && now.getMinutes() >= resetMinute)) {
          userData.Double_XP = 5;
          saveUserData(userData);
          localStorage.setItem('lastDoubleXPCheck', now.toISOString());
        }
      } else if ((now.getHours() > resetHour || (now.getHours() === resetHour && now.getMinutes() >= resetMinute)) &&
                 (lastCheck.getHours() < resetHour || (lastCheck.getHours() === resetHour && lastCheck.getMinutes() < resetMinute))) {
        // Si c'est le même jour mais qu'on est passé après 9h30
        userData.Double_XP = 5;
        saveUserData(userData);
        localStorage.setItem('lastDoubleXPCheck', now.toISOString());
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const userData = getUserData();

      if (userData.version !== game_version) {
        window.location.href = "mise_a_jour.html";
      }

      resetDoubleXPIfNeeded();

      // Vérification de la valeur Double_XP
      if (userData.Double_XP > 0) {
        document.querySelector('.double-xp').style.display = 'block';
      }
    });

  </script>
  
</body>
</html>
