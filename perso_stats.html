<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Strangers Game - Personnages</title>
  <style>
    body {
      text-align: center;
      font-family: 'Arial', sans-serif;
      
      background-size: cover;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }
    .title {
      font-size: 48px;
      margin-bottom: 20px;
      padding-top: 50px;
      text-shadow: 2px 2px 4px #000000;
    }
    .character-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin: 20px;
    }
    .character {
      background-color: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 1.5s;
    }
    .character.unlocked {
      background-color: rgba(255, 69, 0, 1); /* Couleur verte pour les personnages débloqués */
    }
    .character:hover {
      transform: scale(1.05);
    }
    .stats {
      display: none;
      background-color: rgba(255, 255, 255, 0.9);
      color: #000;
      padding: 20px;
      border-radius: 10px;
      position: fixed;
      bottom: -100%;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      max-width: 400px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
    .stats.show {
      display: block;
      animation: slideUp 0.5s forwards;
    }
    .stats.hide {
      animation: slideDown 0.5s forwards;
    }
    @keyframes slideUp {
      from { bottom: -100%; }
      to { bottom: 20px; }
    }
    @keyframes slideDown {
      from { bottom: 20px; }
      to { bottom: -100%; }
    }
    .back-button, .improvement-button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    .back-button:hover, .improvement-button:hover {
      background-color: #45a049;
    }
    .improvement-button {
      position: relative;
      margin-left: 10px;
    }
    .clignotant {
      animation: clignotement 1s infinite;
    }
    @keyframes clignotement {
      0% { background-color: #FF0000; }
      50% { background-color: #FF6347; }
      100% { background-color: #FF0000; }
    }
    .dark-theme {
      background-color: #000000; /* Fond noir */
      color: #e0e0e0; /* Texte en gris clair */
    }

    .dark-theme .title {
      color: #ffffff; /* Texte en blanc pour le titre */
      text-shadow: 2px 2px 4px #000000; /* Ombre du texte pour le titre */
    }

    .dark-theme .character {
      background-color: #333333; /* Fond gris foncé pour les personnages non débloqués */
      color: #e0e0e0; /* Texte en gris clair */
      border: 1px solid #444444; /* Bordure légèrement plus claire pour les personnages non débloqués */
    }

    .dark-theme .character.unlocked {
      background-color: #000000; /* Fond noir pour les personnages débloqués */
      color: #ffffff; /* Texte en blanc pour les personnages débloqués */
      border: 1px solid #444444; /* Bordure légèrement plus claire pour les personnages débloqués */
    }

    .dark-theme .character:hover {
      transform: scale(1.05); /* Effet de zoom lors du survol */
    }

    .dark-theme .stats {
      background-color: rgba(0, 0, 0, 0.9); /* Fond très sombre pour les statistiques */
      color: #e0e0e0; /* Texte en gris clair */
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); /* Ombre légère pour le contraste */
    }

    .dark-theme .back-button, .dark-theme .improvement-button {
      background-color: #222222; /* Fond gris foncé pour les boutons */
      color: #e0e0e0; /* Texte en gris clair */
      border: 1px solid #444444; /* Bordure légèrement plus claire pour les boutons */
    }

    .dark-theme .back-button:hover, .dark-theme .improvement-button:hover {
      background-color: #444444; /* Fond gris légèrement plus clair au survol */
    }

    .dark-theme .clignotant {
      animation: clignotement-dark 1s infinite; /* Animation de clignotement pour le thème sombre */
    }

    @keyframes clignotement-dark {
      0% { background-color: #ff5555; }
      50% { background-color: #ff4444; }
      100% { background-color: #ff5555; }
    }

  </style>
</head>
<body>
  <div class="title">Personnages</div>
  <div class="character-container">
    <!-- Les personnages seront injectés ici via JavaScript -->
  </div>
  <div class="stats">
    <!-- Les statistiques seront affichées ici -->
  </div>
  <a href="menu_principal.html" class="back-button">Retour</a>
  <a href="amelioration.html" class="improvement-button" id="improvementButton">Amélioration</a>

  <script>
    // Données des personnages
    const characters = [
      { name: "Willy", pv: 11200, attaque: 470, defense: 80, spe: "Il effectue deux attaques." },
      { name: "Cocobi", pv: 10800, attaque: 440, defense: 115, spe: "Réduit les PV de l'adversaire de 10% de ses PV maximum." },
      { name: "Oiseau", pv: 9800, attaque: 510, defense: 85, spe: "Inflige des dégâts équivalents à 2.5 fois son attaque et augmente sa défense de 20 pour les deux prochains tours." },
      { name: "Gros Nounours", pv: 13000, attaque: 430, defense: 68, spe: "Inflige des dégâts équivalents à 500 plus son attaque, en ignorant la moitié de la défense de l'adversaire." },
      { name: "Baleine", pv: 10500, attaque: 430, defense: 115, spe: "Si sa défense est inférieure à 29, il effectue une attaque normale. Sinon, il perd 10 de défense et gagne 1000 PV avant d'attaquer normalement." },
      { name: "Doudou", pv: 13800, attaque: 350, defense: 80, spe: "Régénère des PV. Si elle a plus de la moitié de ses PV maximum, elle régénère 5% de ses PV actuels. Sinon, elle régénère 15% de ses PV actuels." },
      { name: "Coeur", pv: 10000, attaque: 450, defense: 100, spe: "Inflige des dégâts équivalents à 1.5 fois son attaque. Si ses PV sont supérieurs à la moitié de ses PV maximum, il régénère 10% des dégâts infligés. Sinon, il régénère 15% des dégâts infligés." },
      { name: "Diva", pv: 10700, attaque: 440, defense: 100, spe: "Réduit l'attaque de l'adversaire de 20% pour les trois prochains tours." },
      { name: "Poulpy", pv: 11500, attaque: 440, defense: 100, spe: "Inflige des dégâts équivalents à 1.75 fois son attaque, en ignorant 50% de la défense de l'adversaire. Réduit la défense de l'adversaire de 15% pour les deux prochains tours." },
      { name: "Colorina", pv: 9600, attaque: 420, defense: 80, spe: "Inflige des dégâts équivalents à 85% de son attaque et réduit la défense de l'adversaire de 15% pour les trois prochains tours." }
    ];

    const characterContainer = document.querySelector('.character-container');
    const statsElement = document.querySelector('.stats');
    const improvementButton = document.getElementById('improvementButton');

    // Fonction pour afficher les statistiques mises à jour en fonction du niveau
    const displayCharacterStats = (character) => {
      const userData = getUserData();
      const isUnlocked = userData[character.name] === 1;

      if (isUnlocked) {
        const level = userData[`${character.name}_Level`] || 1;
        const currentPV = Math.round(character.pv * (1 + (level - 1) * 0.08));
        const currentAttaque = Math.round(character.attaque * (1 + (level - 1) * 0.08));
        const currentDefense = character.defense;

        // Afficher les statistiques normalement
        statsElement.innerHTML = `
          <strong>${character.name}</strong><br>
          Niveau: ${level}<br>
          PV: ${currentPV}<br>
          Attaque: ${currentAttaque}<br>
          Défense: ${currentDefense}<br>
          Spéciale: ${character.spe}
        `;
      } else {
        // Afficher "(personnage non débloqué)" pour le niveau, et les autres statistiques normalement
        statsElement.innerHTML = `
          <strong>${character.name}</strong><br>
          Niveau: (personnage non débloqué)<br>
          PV: ${character.pv}<br>
          Attaque: ${character.attaque}<br>
          Défense: ${character.defense}<br>
          Spéciale: ${character.spe}
        `;
      }

      // Afficher la boîte de statistiques
      statsElement.classList.remove('hide');
      statsElement.classList.add('show');
    };

    // Générer les éléments des personnages
    characters.forEach(character => {
      const charElement = document.createElement('div');
      charElement.className = 'character';
      if (getUserData()[character.name] === 1) {
        charElement.classList.add('unlocked'); // Ajouter la classe "unlocked" aux personnages débloqués
      }
      charElement.textContent = character.name;

      charElement.addEventListener('click', () => {
        displayCharacterStats(character); // Afficher les stats mises à jour lors du clic sur un personnage
      });

      characterContainer.appendChild(charElement);
    });

    // Fonction pour masquer la boîte de statistiques
    const hideStats = () => {
      statsElement.classList.remove('show');
      statsElement.classList.add('hide');
    };

    // Ajouter l'événement de glissement vers le bas
    let startY, currentBottom;
    const maxHeight = 100; // La hauteur maximale à laquelle la boîte arrête de suivre le doigt

    statsElement.addEventListener('touchstart', (e) => {
      startY = e.touches[0].clientY;
      currentBottom = parseInt(window.getComputedStyle(statsElement).bottom, 10);
      statsElement.style.transition = 'none'; // Désactiver la transition pour le glissement
    });

    statsElement.addEventListener('touchmove', (e) => {
      const touchY = e.touches[0].clientY;
      const deltaY = startY - touchY;
      if (deltaY < 0) { // Se déplacer seulement vers le bas
        const newBottom = Math.min(currentBottom + deltaY, maxHeight);
        statsElement.style.bottom = `${newBottom}px`;
      }
    });

    statsElement.addEventListener('touchend', () => {
      if (parseInt(statsElement.style.bottom, 10) < maxHeight / 2) {
        statsElement.style.transition = 'bottom 0.3s ease-out'; // Réactiver la transition vers le bas
        statsElement.style.bottom = '20px'; // Redéfinir la position initiale si suffisamment tirée vers le bas
        hideStats();
      } else {
        statsElement.style.bottom = '20px'; // Redéfinir la position initiale si pas assez glissée
      }
    });

    // Empêcher le défilement de la page lors d'un glissement sur la boîte de statistiques
    statsElement.addEventListener('touchmove', (e) => {
      e.preventDefault();
    }, { passive: false });

    // Fonction pour obtenir les données utilisateur de localStorage
    function getUserData() {
      const userData = JSON.parse(localStorage.getItem('userData'));
      if (userData.theme) {
        document.body.classList.add('dark-theme');
      }
      return userData || {}; // Retourne un objet vide si les données ne sont pas définies
    }

    // Vérifier si les données utilisateur existent, sinon initialiser avec les valeurs par défaut
    if (!localStorage.getItem('userData')) {
      localStorage.setItem('userData', JSON.stringify({
        nbr_perso: 2,
        victoires: 0,
        defaites: 0,
        trophees: 0,
        argent: 0,
        VICTOIRE: false,
        version: '2.0.0',
        recompense: 0,
        perso_recompense: 0,
        xp_du_jour: 0,
        Willy: 1,
        Willy_XP: 0,
        Willy_Level: 1,
        Willy_boost: 0,
        Cocobi: 1,
        Cocobi_XP: 0,
        Cocobi_Level: 1,
        Cocobi_boost: 0,
        Oiseau: 0,
        Oiseau_XP: 0,
        Oiseau_Level: 1,
        Oiseau_boost: 0,
        Gros_Nounours: 0,
        Gros_Nounours_XP: 0,
        Gros_Nounours_Level: 1,
        Gros_Nounours_boost: 0,
        Baleine: 0,
        Baleine_XP: 0,
        Baleine_Level: 1,
        Baleine_boost: 0,
        Doudou: 0,
        Doudou_XP: 0,
        Doudou_Level: 1,
        Doudou_boost: 0,
        Coeur: 0,
        Coeur_XP: 0,
        Coeur_Level: 1,
        Coeur_boost: 0,
        Diva: 0,
        Diva_XP: 0,
        Diva_Level: 1,
        Diva_boost: 0,
        Poulpy: 0,
        Poulpy_XP: 0,
        Poulpy_Level: 1,
        Poulpy_boost: 0,
        Colorina: 0,
        Colorina_XP: 0,
        Colorina_Level: 1,
        Colorina_boost: 0,
        Double_XP: 5,
        Double_XP_acheté: 0,
        Potion_de_Santé_acheté: 0,
        Amulette_de_Régénération_acheté: 0,
        lastDoubleXPCheck: 0,
        theme: false // Défaut clair
      }));
    }

    // Fonction pour sauvegarder les données utilisateur dans localStorage
    function saveUserData(userData) {
      localStorage.setItem('userData', JSON.stringify(userData));
    }

    // Fonction pour ajuster aléatoirement les personnages
    function adjustCharacters(nbr_perso) {
      const userData = getUserData();
      const characters = [
        'Willy', 'Cocobi', 'Oiseau', 'Gros_Nounours', 'Baleine', 'Doudou',
        'Coeur', 'Diva', 'Poulpy', 'Colorina'
      ];

      // Filtrer les personnages déjà à 1
      const charactersAlreadyOne = characters.filter(char => userData[char] === 1);

      // Si le nombre de personnages à 1 est déjà égal à nbr_perso, pas besoin d'ajuster
      if (charactersAlreadyOne.length === nbr_perso) {
        return;
      }

      // Tant que le nombre de personnages à 1 n'est pas égal à nbr_perso, ajuster aléatoirement
      while (charactersAlreadyOne.length < nbr_perso) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        const character = characters[randomIndex];

        // Vérifier si le personnage sélectionné est déjà à 1, si oui, continuer la boucle
        if (userData[character] === 1) {
          continue;
        }

        // Mettre ce personnage à 1
        userData[character] = 1;

        // Mettre à jour nom_first à true si nécessaire
        if (!userData[`${character}_first`]) {
          userData[`${character}_first`] = true;
        }

        // Initialiser les statistiques de niveau et XP pour ce personnage
        userData[`${character}_Level`] = 1;
        userData[`${character}_XP`] = 0;

        // Ajouter ce personnage à la liste des personnages à 1
        charactersAlreadyOne.push(character);
      }

      // Sauvegarder les données mises à jour dans localStorage
      saveUserData(userData);
    }

    // Appeler la fonction pour ajuster les personnages au chargement de la page ou au besoin
    adjustCharacters(getUserData().nbr_perso);

    // Vérifier si un personnage peut être amélioré et activer le clignotement si nécessaire
    function checkForImprovement() {
      const userData = getUserData();
      let improvementPossible = false;

      characters.forEach(character => {
        const level = userData[`${character.name}_Level`] || 1;
        const xp = userData[`${character.name}_XP`] || 0;
        const requiredXP = level * 100; // Par exemple, l'XP nécessaire pour le prochain niveau

        if (xp >= requiredXP) {
          improvementPossible = true;
        }
      });

      if (improvementPossible) {
        improvementButton.classList.add('clignotant');
      } else {
        improvementButton.classList.remove('clignotant');
      }
    }

    // Vérifier l'amélioration possible au chargement de la page
    checkForImprovement();
  </script>
</body>
</html>
